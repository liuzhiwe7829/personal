sentinel.conf
```
port 26379
#1表示在sentinel集群中只要有两个节点检测到redis主节点出故障就进行切换，单sentinel节点无效(自己测试发现的)
#如果3s内mymaster无响应，则认为mymaster宕机了
#如果10秒后,mysater仍没活过来，则启动failover
sentinel myid da997a2a2d1ef3a59e5d9e5c7841de88606fd684
sentinel monitor mymaster 192.168.26.55 6379 1
sentinel down-after-milliseconds mymaster 3000
daemonize yes
#指定工作目录
dir "/mwbase/appsystem/Redis/redis-4.0.9/redis-sentinel/26379"
protected-mode no
logfile "/mwbase/applogs/rtlog/sentinel.log"
#redis主节点密码
sentinel failover-timeout mymaster 10000
# Generated by CONFIG REWRITE

maxclients 4064
sentinel auth-pass mymaster 123456
sentinel config-epoch mymaster 590
sentinel leader-epoch mymaster 590
sentinel known-slave mymaster 192.168.26.59 6379
sentinel known-slave mymaster 192.168.26.56 6379
sentinel known-slave mymaster 192.168.26.54 6379
sentinel known-sentinel mymaster 192.168.26.55 26379 9def33f150dd736042a40f23deefd2f59080e6c0
sentinel known-sentinel mymaster 192.168.26.54 26379 cdda45b44a48f4dbaf3bbb9aec957dd9911fde40
sentinel current-epoch 590
```

###### 启动redis 
```
291  netstat -ntlp
292  kill -9 1317
293  netstat -ntlp
294  free -m
295  ./redis-server  /mwbase/appsystem/Redis/redis-4.0.9/redis-sentinel/26379/sentinel.conf --sentinel

redis-cli -h 127.0.0.1 -p 26379
./redis-cli –h 192.168.26.54 –p 6379 –a 123456


  480  ./redis-cli -h 127.0.0.1 -p 26379
  481  ./redis-cli -h 127.0.0.1 -p 6379
  482  ./redis-cli -h 127.0.0.1 -p 26379 -a 123456
  483  ./redis-cli -h 127.0.0.1 -p 6379 -a 123456
  484    netstat -anlp |grep 1513 |grep "192.168.13.50" |wc - l

```


###### sentinel.log 解读
![image](E12450182D4940FE8909221EBC8F3793)
```
先是本sentinel将master标识为sdown，主观下线

然后标识为odown，客观下线。quorum即设置的阈值，有多个sentinel节点将其标识为下线就认为master确实down掉了。不小心把阈值改成了1......

---- 主观下线->客观下线
 

try-failover  尝试进行故障转移，认为1.7发生故障不能再工作，需要把master这个位子转交给某个slave。failover  故障转移，fail over。

elected-leader  开始在slave中选新的master

selected-slave  选中了1.8作为新的master

 

failover-state 是故障转移的状态、进程，包括：

send-slaveof-noone  向1.8发送slaveof  no  one，即摆脱slave的地位

wait-promotion  等待1.8晋升为master，promotion  促进、提升、晋升

promoted  晋升完成，1.8成为新的master

之后就是其它slave从新的master处同步数据。

 
```



##### redis 持久化
```
RDB机制

1、save触发方式 
执行save命令期间，Redis不能处理其他命令，直到RDB过程完成为止
2、bgsave触发方式
执行该命令时，Redis会在后台异步进行快照操作，快照同时还可以响应客户端请求。
3、自动触发
AOF机制



RDB 的优势和劣势
①、优势
（1）RDB文件紧凑，全量备份，非常适合用于进行备份和灾难恢复。
（2）生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。
（3）RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。
②、劣势
RDB快照是一次全量备份，存储的是内存数据的二进制序列化形式，存储上非常紧凑。当进行快照持久化时，会开启一个子进程专门负责快照持久化，子进程会拥有父进程的内存数据，父进程修改内存子进程不会反应出来，所以在快照持久化期间修改的数据不会被保存，可能丢失数据。



AOF 
特点 实时记录，恢复慢，文件大
```




